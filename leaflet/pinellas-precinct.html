<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Pinellas Precinct Map</title>
    <link rel="stylesheet" href="leaflet.css" />
    <script src="leaflet.js" ></script>
  </head>
  <body>


    <!-- load jquery -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <!-- Load jquery-csv -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/0.8.3/jquery.csv.min.js"></script>

    <!-- Create map (standard, requires set height) -->
    <div id='map1' style='width: 100%; height: 250px;'></div>
    <div id='map2' style='width: 100%; height: 250px;'></div>

    <!-- Load state geoJSON (standard) -->
    <script type="text/javascript" src="precinctsDataWithPrimary.js"></script>

    <!-- Load state data JSON (custom) -->
    <!-- <script type="text/javascript" src="data.js"></script> -->

    <!-- <script type="text/javascript" src="municipalities.js"></script> -->

    <!-- Load chroma -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/1.3.4/chroma.min.js"></script>

    <!-- Load custom color picker, default with TBT green, orange and white -->
    <script type="text/javascript">
      function pickColor(choice) {
        if (!choice) {
          return 'white'
        }
        else if ('white') {
          return 'white'
        }
        else if (choice=='green') {
          return '#50a291'
        }
        else if (choice=='orange') {
          return '#FDAF7D'
        }
      }


      function pickScale(choice) {
        if (!choice) {
          return chroma.scale(['white','#50a291']);
        }
        else if (choice=='white-green') {
          return chroma.scale(['white','#50a291']);
        }
        else if (choice=='gray-white-green') {
          return chroma.scale(['#cccccc','white','#50a291']);
        }
        else if (choice=='gray-white-orange') {
          return chroma.scale(['#dddddd','white','#FDAF7D']);
        }
        else if (choice=='gray-white-brightOrange') {
          return chroma.scale(['#dddddd','white','#FF6400']);
        }
        else if (choice=='green-white') {
          return chroma.scale(['#50a291','white']);
        }
        else if (choice=='orange-white-green') {
          return chroma.scale(['#FDAF7D','white','#50a291']);
        }
        else if (choice=='brightOrange-white-green') {
          return chroma.scale(['#FF6400','white','#50a291']);
        }
        else if (choice=='green-white-orange') {
          return chroma.scale(['#50a291','white','#FDAF7D']);
        }
        else if (choice=='green-white-brightOrange') {
          return chroma.scale(['#50a291','white','#FF6400']);
        }
        else if (choice=='white-brightOrange') {
          return chroma.scale(['white','#FF6400']);
        }
      }

      function pickDomain (data, choice) {
        var array = [];
        for (var i = 0; i < data.length; i++) {
          array.push(data[i].properties.value);
        }
        if (!choice) {
          return [Math.min(...array), Math.max(...array)]
        }
        else {
          if (choice.includes('min')) {
            choice[choice.indexOf('min')]=Math.min(...array);
          }
          if (choice.includes('max')) {
            choice[choice.indexOf('max')]=Math.max(...array);
          }
          return choice
        }

      }
    </script>
    <script>

      var mappedData;

      // Set  map.
      var map1 = L.map('map1', {
        zoomSnap: 0.25
      }).setView([27.912390, -82.749999], 10);

      // Load mapbox tile, add to map
      L.tileLayer('https://api.mapbox.com/styles/v1/ltaylor11/cj9okho5d4hj92roaopd3wksn/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoibHRheWxvcjExIiwiYSI6ImNqOWhndGV0cjJ6ZmIyeHBhMzVqbG42d2kifQ.PDNpdxh13YZxmaQWEqQTSg', {
        attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>'
      }).addTo(map1);

      // Pick color scale and domain
      // var cscale=pickScale('orange-white-green');
      var cscale=chroma.scale(['#C90000','white','#025480']);

      // pickDomain(data, [choice]). [choice] accepts numbers or 'min' or 'max'. number of entries should correspond to number of color steps in pickScale
      cscale.domain(pickDomain(precinctsData.features,[0,1]));

      // L.geoJson(statesData).addTo(map1);
      function  style(feature) {
        if (feature.properties.municipality) {
          var kriseShare = Number(feature.properties.primaryVotes.kriseman_Total) / (Number(feature.properties.primaryVotes.kriseman_Total) + Number(feature.properties.primaryVotes.baker_Total));
          // console.log(kriseShare);
          return {
            fillColor: cscale(kriseShare),
            fillOpacity: 0.8,
            color: '#555555',
            weight: 1.5,
            opacity: 0.4
          };
        }
        else {
          return {
            fillColor: '#aaaaaa',
            fillOpacity: 0,
            color: 'white',
            weight: 1.5,
            opacity: 0
          };
        }
      }

      // console.log(precinctsData);
      L.geoJson(precinctsData.features, {style: style}).addTo(map1);


    </script>

    <script>

      var mappedData;

      // Set  map.
      var map2 = L.map('map2', {
        zoomSnap: 0.25
      }).setView([27.912390, -82.749999], 10);

https://api.mapbox.com/styles/v1/ltaylor11/cj9okho5d4hj92roaopd3wksn/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoibHRheWxvcjExIiwiYSI6ImNqOWhndGV0cjJ6ZmIyeHBhMzVqbG42d2kifQ.PDNpdxh13YZxmaQWEqQTSg

      // Load mapbox tile, add to map
      L.tileLayer('https://api.mapbox.com/styles/v1/ltaylor11/cj9okho5d4hj92roaopd3wksn/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoibHRheWxvcjExIiwiYSI6ImNqOWhndGV0cjJ6ZmIyeHBhMzVqbG42d2kifQ.PDNpdxh13YZxmaQWEqQTSg', {
        attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>'
      }).addTo(map2);

      // Pick color scale and domain
      var cscale2=pickScale('white-brightOrange');
      // var cscale=chroma.scale(['#C90000','white','#025480']);

      // pickDomain(data, [choice]). [choice] accepts numbers or 'min' or 'max'. number of entries should correspond to number of color steps in pickScale
      cscale2.domain(pickDomain(precinctsData.features,[0,0.6]));

      // L.geoJson(statesData).addTo(map1);
      function  style(feature) {
        if (feature.properties.municipality) {
          return {
            fillColor: cscale2(feature.properties.primaryVotes.turnout),
            fillOpacity: 0.8,
            color: '#555555',
            weight: 1.5,
            opacity: 0.4
          };
        }
        else {
          return {
            fillColor: '#aaaaaa',
            fillOpacity: 0,
            color: 'white',
            weight: 1.5,
            opacity: 0
          };
        }
      }

      L.geoJson(precinctsData.features, {style: style}).addTo(map2);

    </script>




  </body>
</html>
