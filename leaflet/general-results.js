var officialVotes = [{"precinct_name":101,"baker_total":574,"kriseman_total":753,"total":1327},
{"precinct_name":102,"baker_total":285,"kriseman_total":416,"total":701},
{"precinct_name":103,"baker_total":171,"kriseman_total":252,"total":423},
{"precinct_name":104,"baker_total":307,"kriseman_total":440,"total":747},
{"precinct_name":105,"baker_total":529,"kriseman_total":829,"total":1358},
{"precinct_name":106,"baker_total":216,"kriseman_total":293,"total":509},
{"precinct_name":107,"baker_total":360,"kriseman_total":450,"total":810},
{"precinct_name":108,"baker_total":525,"kriseman_total":566,"total":1091},
{"precinct_name":109,"baker_total":369,"kriseman_total":427,"total":796},
{"precinct_name":110,"baker_total":49,"kriseman_total":101,"total":150},
{"precinct_name":111,"baker_total":132,"kriseman_total":172,"total":304},
{"precinct_name":112,"baker_total":297,"kriseman_total":359,"total":656},
{"precinct_name":113,"baker_total":308,"kriseman_total":224,"total":532},
{"precinct_name":114,"baker_total":237,"kriseman_total":193,"total":430},
{"precinct_name":115,"baker_total":262,"kriseman_total":172,"total":434},
{"precinct_name":116,"baker_total":207,"kriseman_total":267,"total":474},
{"precinct_name":117,"baker_total":186,"kriseman_total":143,"total":329},
{"precinct_name":118,"baker_total":175,"kriseman_total":447,"total":622},
{"precinct_name":119,"baker_total":320,"kriseman_total":343,"total":663},
{"precinct_name":120,"baker_total":424,"kriseman_total":412,"total":836},
{"precinct_name":121,"baker_total":46,"kriseman_total":137,"total":183},
{"precinct_name":122,"baker_total":15,"kriseman_total":34,"total":49},
{"precinct_name":123,"baker_total":574,"kriseman_total":1108,"total":1682},
{"precinct_name":125,"baker_total":196,"kriseman_total":430,"total":626},
{"precinct_name":126,"baker_total":98,"kriseman_total":133,"total":231},
{"precinct_name":127,"baker_total":175,"kriseman_total":701,"total":876},
{"precinct_name":128,"baker_total":284,"kriseman_total":615,"total":899},
{"precinct_name":129,"baker_total":332,"kriseman_total":675,"total":1007},
{"precinct_name":130,"baker_total":750,"kriseman_total":856,"total":1606},
{"precinct_name":131,"baker_total":217,"kriseman_total":213,"total":430},
{"precinct_name":132,"baker_total":193,"kriseman_total":196,"total":389},
{"precinct_name":133,"baker_total":251,"kriseman_total":286,"total":537},
{"precinct_name":134,"baker_total":172,"kriseman_total":446,"total":618},
{"precinct_name":135,"baker_total":775,"kriseman_total":1157,"total":1932},
{"precinct_name":136,"baker_total":457,"kriseman_total":521,"total":978},
{"precinct_name":137,"baker_total":333,"kriseman_total":427,"total":760},
{"precinct_name":138,"baker_total":990,"kriseman_total":577,"total":1567},
{"precinct_name":139,"baker_total":282,"kriseman_total":280,"total":562},
{"precinct_name":140,"baker_total":936,"kriseman_total":939,"total":1875},
{"precinct_name":141,"baker_total":389,"kriseman_total":611,"total":1000},
{"precinct_name":142,"baker_total":639,"kriseman_total":480,"total":1119},
{"precinct_name":143,"baker_total":735,"kriseman_total":385,"total":1120},
{"precinct_name":144,"baker_total":1176,"kriseman_total":778,"total":1954},
{"precinct_name":145,"baker_total":651,"kriseman_total":497,"total":1148},
{"precinct_name":146,"baker_total":230,"kriseman_total":222,"total":452},
{"precinct_name":147,"baker_total":230,"kriseman_total":166,"total":396},
{"precinct_name":150,"baker_total":571,"kriseman_total":487,"total":1058},
{"precinct_name":151,"baker_total":298,"kriseman_total":252,"total":550},
{"precinct_name":152,"baker_total":328,"kriseman_total":292,"total":620},
{"precinct_name":153,"baker_total":889,"kriseman_total":676,"total":1565},
{"precinct_name":154,"baker_total":447,"kriseman_total":238,"total":685},
{"precinct_name":155,"baker_total":650,"kriseman_total":553,"total":1203},
{"precinct_name":156,"baker_total":539,"kriseman_total":479,"total":1018},
{"precinct_name":157,"baker_total":157,"kriseman_total":143,"total":300},
{"precinct_name":161,"baker_total":293,"kriseman_total":399,"total":692},
{"precinct_name":162,"baker_total":364,"kriseman_total":506,"total":870},
{"precinct_name":165,"baker_total":0,"kriseman_total":0,"total":0},
{"precinct_name":200,"baker_total":571,"kriseman_total":328,"total":899},
{"precinct_name":201,"baker_total":613,"kriseman_total":526,"total":1139},
{"precinct_name":202,"baker_total":669,"kriseman_total":484,"total":1153},
{"precinct_name":203,"baker_total":240,"kriseman_total":216,"total":456},
{"precinct_name":204,"baker_total":124,"kriseman_total":77,"total":201},
{"precinct_name":205,"baker_total":246,"kriseman_total":217,"total":463},
{"precinct_name":211,"baker_total":153,"kriseman_total":145,"total":298},
{"precinct_name":213,"baker_total":187,"kriseman_total":247,"total":434},
{"precinct_name":215,"baker_total":463,"kriseman_total":231,"total":694},
{"precinct_name":216,"baker_total":428,"kriseman_total":471,"total":899},
{"precinct_name":217,"baker_total":1,"kriseman_total":1,"total":2},
{"precinct_name":219,"baker_total":237,"kriseman_total":304,"total":541},
{"precinct_name":220,"baker_total":157,"kriseman_total":292,"total":449},
{"precinct_name":221,"baker_total":310,"kriseman_total":398,"total":708},
{"precinct_name":222,"baker_total":747,"kriseman_total":788,"total":1535},
{"precinct_name":223,"baker_total":15,"kriseman_total":35,"total":50},
{"precinct_name":224,"baker_total":190,"kriseman_total":196,"total":386},
{"precinct_name":225,"baker_total":249,"kriseman_total":435,"total":684},
{"precinct_name":226,"baker_total":150,"kriseman_total":158,"total":308},
{"precinct_name":227,"baker_total":291,"kriseman_total":344,"total":635},
{"precinct_name":228,"baker_total":102,"kriseman_total":232,"total":334},
{"precinct_name":229,"baker_total":407,"kriseman_total":401,"total":808},
{"precinct_name":230,"baker_total":455,"kriseman_total":313,"total":768},
{"precinct_name":231,"baker_total":577,"kriseman_total":557,"total":1134},
{"precinct_name":232,"baker_total":495,"kriseman_total":432,"total":927},
{"precinct_name":233,"baker_total":323,"kriseman_total":390,"total":713},
{"precinct_name":234,"baker_total":292,"kriseman_total":252,"total":544},
{"precinct_name":235,"baker_total":468,"kriseman_total":430,"total":898},
{"precinct_name":236,"baker_total":51,"kriseman_total":49,"total":100},
{"precinct_name":237,"baker_total":30,"kriseman_total":30,"total":60},
{"precinct_name":239,"baker_total":547,"kriseman_total":579,"total":1126},
{"precinct_name":240,"baker_total":358,"kriseman_total":275,"total":633},
{"precinct_name":241,"baker_total":454,"kriseman_total":408,"total":862},
{"precinct_name":275,"baker_total":146,"kriseman_total":136,"total":282}];
for (var i = 0; i < precinctsData.features.length; i++) {
  precinctsData.features[i].properties.primaryVotes={}
}
for (var i = 0; i < officialVotes.length; i++) {
  for (var j = 0; j < precinctsData.features.length; j++) {
    if (officialVotes[i].precinct_name.toString() === precinctsData.features[j].properties.PRECINCTID) {
      precinctsData.features[j].properties.primaryVotes = officialVotes[i];
    }
  }
}
var map1 = L.map('map1', {
  zoomSnap: 0.25
}).setView([27.812390, -82.749999], 10.75);

L.tileLayer('https://api.mapbox.com/styles/v1/ltaylor11/cj9okho5d4hj92roaopd3wksn/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoibHRheWxvcjExIiwiYSI6ImNqOWhndGV0cjJ6ZmIyeHBhMzVqbG42d2kifQ.PDNpdxh13YZxmaQWEqQTSg', {
  attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>'
}).addTo(map1);

var cscale=chroma.scale(['#C90000','white','#025480']).domain([0,0.5,1]);

function  style(feature) {
  if (feature.properties.municipality) {
    var kriseShare = Number(feature.properties.primaryVotes.kriseman_total) / (Number(feature.properties.primaryVotes.kriseman_total) + Number(feature.properties.primaryVotes.baker_total));
    return {
      fillColor: cscale(kriseShare),
      fillOpacity: 0.8,
      color: '#555555',
      weight: 1.5,
      opacity: 0.4
    };
  }
  else {
    return {
      fillColor: '#aaaaaa',
      fillOpacity: 0,
      color: 'white',
      weight: 1.5,
      opacity: 0
    };
  }
}

function onEachFeatureMargin(feature, layer) {
  var winner;
  if (feature.properties.primaryVotes.kriseman_total > feature.properties.primaryVotes.baker_total) {
    winner = '<b style="color:#025480; font-size:125%; line-height:2;">Kriseman'+': '+(100*((Number(feature.properties.primaryVotes.kriseman_total)/(Number(feature.properties.primaryVotes.baker_total)+Number(feature.properties.primaryVotes.kriseman_total))))).toFixed(2)+'%</b>';
  }
  else if (feature.properties.primaryVotes.kriseman_total < feature.properties.primaryVotes.baker_total) {
    winner = '<b style="color:#C90000; font-size:125%; line-height:2;">Baker'+': '+(100*((Number(feature.properties.primaryVotes.baker_total)/(Number(feature.properties.primaryVotes.baker_total)+Number(feature.properties.primaryVotes.kriseman_total))))).toFixed(2)+'%</b>';
  }
  else {
    winner = 'Tie';
  }
  layer.bindTooltip(
    '<b>Precint '+feature.properties.PRECINCTID+'</b> <br />'+
    winner+'<br />'+
    '<span style="padding-left: 4px; border-left:4px solid #025480">Rick Kriseman: '+feature.properties.primaryVotes.kriseman_total+'</span><br /> <span style="padding-left: 4px; border-left:4px solid #C90000">Rick Baker: '+feature.properties.primaryVotes.baker_total+'</span>'
  );
}
L.geoJson(precinctsData.features, {
  style: style,
  onEachFeature: onEachFeatureMargin
}).addTo(map1);
